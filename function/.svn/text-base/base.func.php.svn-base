<?php
/**test
$hex = 'FFFFFFFFFFFFFFFF';
$dec = base_convert($hex, 16, 10);
$base = '36';

echo
$dec, "\n",
base_convert($hex, 16, $base), "\n", 
base_convert(base_convert($hex, 16, $base), $base, 10), "\n",
dec2base($dec, $base), "\n", 
base2dec(dec2base($dec, $base), $base), "\n",
bc_dec2base($dec, $base), "\n", 
bc_base2dec(bc_dec2base($dec, $base), $base), "\n"
;
*/

function digits($base) {
    if($base < 2 or $base > 256) die("Invalid Base: ".$base);
    if($base < 94){
        $digits62 = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';
        $digits65 = $digits62 . '-_.';             // url not encode
        $digits80 = $digits65 . '!$(*+,/:;=?@[]~'; // mobile url
        $digits87 = $digits80 . '&\')^{|}';        // url
        $digits93 = $digits87 . '%#<>\`';          // char
    } else {
        for($i = 0; $i < $base; $i++) {
            $digits256 .= chr($i);
        }
    }
    $digits = (isset($digits93) ? $digits93 : $digits256);
    return substr($digits, 0, $base);
}

function bc_dec2base($dec, $base, $digits=false) {
    if($base < 2 or $base > 256) die("Invalid Base: ".$base);
    bcscale(0);
    $value = "";
    if(!$digits) $digits = digits($base);
    while($dec > $base-1) {
        $rest  = bcmod($dec,$base);
        $dec   = bcdiv($dec,$base);
        $value = $digits[$rest].$value;
    }
    $value = $digits[intval($dec)].$value;
    return (string) $value;
}

function bc_base2dec($value, $base, $digits=false) {
    if($base < 2 or $base > 256) die("Invalid Base: ".$base);
    bcscale(0);
    if(!$digits) {
        $digits = digits($base);
        if($base < 37) {
            $value = strtolower($value);
        }
    }
    $size = strlen($value);
    $dec  = "0";
    for($loop = 0; $loop < $size; $loop++) {
        $element = strpos($digits, $value[$loop]);
        $power   = bcpow($base, $size-$loop-1);
        $dec     = bcadd($dec, bcmul($element, $power));
    }
    return (string) $dec;
}

function dec2base( $dec, $base, $digits=false ) {
    if(function_exists('bcscale')){
        return bc_dec2base($dec, $base, $digits);
    }
    $digits = (!$digits ? digits($base) : $digits );
    $out = "";
    for ( $t = floor( log10( $dec ) / log10( $base ) ); $t >= 0; $t-- ) {
        $a = floor( $dec / pow( $base, $t ) );
        $out = $out . substr( $digits, $a, 1 );
        $dec = $dec - ( $a * pow( $base, $t ) );
    }
    return $out;
}

function base2dec( $dec, $base, $digits=false ) {
    if(function_exists('bcscale')){
        return bc_base2dec($dec, $base, $digits);
    }
    
    $digits = (!$digits ? digits($base) : $digits );
    $out = 0;
    $len = strlen( $dec ) - 1;
    for ( $t = 0; $t <= $len; $t++ ) {
        $out = $out + strpos( $digits, substr( $dec, $t, 1 ) ) * pow( $base, $len - $t );
    }
    return $out;
}

?>
