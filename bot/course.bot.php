<?php

function bot(){
    $course_id = array("04000096", "04011531", "04011553", "04000102", "04000100", "04000088", "04081931", "04000097", "04041508", "04041515", "04041567", "04011561", "04000082", "04000080", "04000086", "04000083", "04041427", "04041522", "04041571", "04041444", "04041445", "04041450", "04041466", "04041467", "04041476", "04041517", "04041518", "04021225", "04061449", "04000098", "04111195", "04111930", "04000081", "0451G863", "0451G864", "0451G861", "0451G862", "04011569", "04000084", "04000087", "04000089", "04000094", "04011573", "04011574", "04011861", "04000091", "04071902", "04051003", "04071955", "04041486", "04000095", "04041488", "04041523", "04041423", "04071479", "04071472", "04091468", "04061461", "04061462", "04011546", "04000092", "04000093", "04011526", "04011540", "04011541", "04041430", "04021289", "04071274", "04071478", "04071480", "0451G865", "04011545", "04041447", "04091463", "04091464", "0451G303", "0451G306", "04071956", "04071909", "04041902", "04041375");
    $course_id = array('04041476');
    foreach($course_id as $i){
        $url = "http://jwc.ecjtu.jx.cn/mis/course.php?job=query&var_course=$i";
        /*
        $tmp = './tmp/course/'.$i;
        if( is_file($tmp) ){
            $res = file_get_contents($tmp);
        } else {
            $res = curl($url);
            file_put_contents($tmp, $res);
        }*/
        $res = file_get_contents($url);
        preg_match_all("|<tr><td>(.*?)</td>(?:\W+)?<td>(.*?)</td>(?:\W+)?<td>(.*?)</td>(?:\W+)?<td>(.*?)</td>(?:\W+)?<td>(.*?)</td>(?:\W+)?<td>(.*?)</td>(?:\W+)?<td>(.*?)</td>(?:\W+)?<td>(.*?)</td>(?:\W+)?</tr>|", $res, $out, PREG_SET_ORDER);
        foreach($out as $line){
            unset($line[0]);
            file_put_contents('./course', implode("\t",$line)."\n", FILE_APPEND);
        }
    }
}
?>
