<BOF>
DataTrans-1000软件性能改进及错误修正记载

    本文件详细记载了每个版本重要的改进性能和改正错误过程，便于用户
在版本升级时掌握软件动态情况。
    由于印刷版本的用户手册和参考手册有一定的滞后时间，本文件能够
弥补印刷本手册的不足。

1997.3.10
logutil.exe升0.02版:
    保存用户和组信息后不用退出DBENGINE.EXE。

1997.3.11
gcs.exe:
    在详细窗CTRL+A功能中，010$a-->210功能当010字段是头标区下的
第一个字段时，MoveTo宏找不到010$a内容。此错误已改正。

1997.3.25
gcs.exe:
    中文图书CTRL+A功能中905$b-->906子功能改配置为插入符在906字段
上敏感。
    CTRL+A功能中用于拆分905$b的宏以前遇到$b1-100和$b79-82这样的
情况不能处理，经过改进现在已经能够处理。另外，与此功能类似的f2f.exe
中拆分905$b的功能也已经改进。

mtf2file.exe:
     在一个书目库中具备较长的-01字段时
(例如/tcpip/132.147.160.1/中央库(中文图书)/ctlno/0000001)，
用mtf2file.exe程序转出ISO2709格式文件，然后重新安装一个本地方式的
DT1000系统，将这个文件转入某个书目库中，这时书目库记录中保留了原
来的-01字段。再次用mtf2file.exe转出这个本地书目库的记录，在缺省方式
下由于要为每个记录产生新的-01字段，而新的-01字段比较短，要替代原
记录中的长的-01字段，这时程序mtf2file.exe发生故障。此错误已经改正。

hotpoint.exe
    在DBKERNEL模式下，当数据库内核未启动时，启动hotpoint.exe在报告
一定信息后系统锁住(PWindows 3.2下，其他环境未测)。此故障已经排除。

logutil.exe
    在区段窗中选择数据库名，出现组合框，在数据库名所在行上双击不能
起到选择数据库并且结束对话框的作用。经改进双击已经起作用。

1997.3.28
gcs.exe:
    详细窗中装入一条普通书目记录时按CTRL+N键出现GP错。已改正。
    gcs.exe为3.11版。
    详细窗的表格框增加CTRL+Z填入缺省值的功能。在各库fld.cfg配置文件
中的对齐特性后可以配置缺省值，其中可以含有宏。宏目前有：
    %copyup% or %cu% : 从上一行的对应列拷贝
    %copyblow% or %cb% : 从下一行的对应列拷贝
    %linenumber% or %ln% : 行号 , 从 1 计数
    %columnumber% or %cn% : 列号 , 从 1 计数
    %previnc%  or %pi%: 前面号码加1
    %prevdec%  or %pd%: 前面号码减1, 但最小为0
    %year%  or %y%: 4 byte 年 4字符
    %month% or %m%: 月 m2为2字符
    %day% or %d%:   日 d2
    %hour% or %h%:  小时 h2
    %minute% or %min%: 分  m2
    %seond% or %sec%:  秒  sec2
    %hsecond% or %hsec%: 毫秒  hsec2

1997.3.31
gcs.exe:
    以新的灵活全面的打印功能，替代原来只能打印详细窗超文本控制内容的
打印功能。
    当详细窗激活时，可选择工具条上打印按钮，进行各种产品的打印。用到
配置文件batprint.ini。缓冲打印的目的是产生一个叫做slgprint.prn的临时
文件，在兑现缓冲时一次性送到打印机。立即打印是将本次打印内容连同以前
积累在打印缓冲文件中的内容送到打印机。缓冲打印的好处是在打印纸张比
输出页面大时，可以将若干页面打满一张纸。而立即打印只要打印就立即走完
一张纸。

1997.4.1
gcs.exe:
    ---
    详细窗中CTRL+A功能，宏命令CpyStr和CatStr用到的字符串常量增加转义
字符支持，支持的转义字符如下：
    转义字符    ASCII码值   意义
    \$          31          ISO2709的子字段标识符
    \a          7
    \b          8           Bell 响铃
    \t          9           Tab
    \n          10          Line Feed
    \v          11
    \f          12
    \r          13          Carridge Return
    ---
    另外，当命令{CpyStr "\$12001 " _1}执行时实际效果去掉了末尾的空格。
此错误已经改正。
    ---
    在检索窗目录树框上双击配置文件名，出现的编辑窗口变大了一些。
    ___
    以前的版本在只开一个检索窗的前提下，最多可开的详细窗为6个(16M内存，
运行PWindows 3.2的486DX4 100MHz)，在开第7个的时候出现“需要1216字节”
的系统提示，然后反复按OK按钮均不能退出提示对话框回到正常状态。原因是
以前版本开辟详细窗和检索窗的内存用到了malloc函数，使用的是局部堆上的
空间，有限的空间很快会耗净。现已改为使用全局堆上的空间，同样的机器最多
可以开辟窗口20个左右。

hyper.dll
    在批(缓冲)打印时，超文本命令{CharSep:n}(注：n代表数字)会发生错误，
症状是字间距特别大。此错误已经改正。

1997.4.2
gcs.exe
    ----
    修改了堆栈的用法，避免对堆栈的过度使用。
    ----
    版本升级为3.12。

1997.4.7
gcs.exe
    ----
    详细窗中CTRL+A功能增加宏命令IncNumber，将剪裁板中的数字内容加1，
如果前方有$?两字符，还要去掉这两个字符。并且为中央库auto.cfg文件
增配了905$e自动产生种次号的功能。

1997.4.8
gcs.exe
    ----
    '功能'菜单中的'刷新本地配置文件'菜单项目改名为'刷新网络配置文件
本地映像'.
    在'功能'菜单中增加了修改口令字的功能.
    ----
    在'特性'菜单中的MARC框子菜单中，增加'窗口边缘折行'和'固定位置折行'
两种风格选择。窗口边缘折行风格的特点是，当窗口的大小发生改变时，MARC
控制部件能够自动调整折行位置，保证每行在左右方向上全部可见。固定位置
折行则始终以屏幕最大宽度为折行位置，只有在窗口最大化的时候，每行的
左右方向才全部可见。
    ----
    详细窗中增加CTRL+SHIFT+PAGEUP和CTRL+SHIFT+PAGEDOWN键，用于在检索
命中的一批记录中前后翻看。这个功能要具备的条件是，检索窗刚刚检索命中
了一批记录，详细窗处于激活状态。如果没有打开的检索窗，此功能无效。
如果打开的检索窗有多个，本功能只对最近激活的一个检索窗发生作用。
card.dll
    ----
    将机内格式的数据送入card.dll，然后加工成超文本文件。如果MARC数据
正文中有符号{、}和%与超文本命令保留字符串冲突，以前版本的card.dll未能
加以妥善处理，后续环节的hyper.dll因此可能会发生GP错。
    现在card.dll针对MARC数据正文中这3个保留符号进行了处理，每个符号
都预先变成2个重复的符号。在hyper.dll中将重复的这保留字符作为正文处理。
hyper.dll
    ----
    将重复出现的符号{、}或%作为正文处理。例如：
    {HB}10%%的增长{HE}                  显示效果为  10%的增长
    {HB}关于命令{{HB}}{HE}              显示效果为  关于命令{HB}
editor.dll
    ----
    当插入符在字段名上时，按INS键或DEL键可以插入或删除一个字段。原来
出现提示对话框后，必须按回车键或鼠标才能确认，现在改进为在对话框中按
INS或DEL键即可确认。
table.dll
    ----
    原来的版本中消息GTB_SETCURSEL残留原来选择所在行的虚线框。此错误
已经改正。

1997.4.10
gcs.exe
    ----
    增加在启动gcs.exe前，自动启动数据库内核的功能。这个功能缺省启动类
名为DBServerClass、窗口标题为DBServer running...、运行程序名为
dbengine.exe的数据库内核。数据库内核程序应当和gcs.exe在同一个子
目录中。
    可以通过修改windows系统子目录中的gcs.ini文件来控制启动过程。
    在[PRESTART]小节中：
    ClassName=
    Title=
    ExeName=
    控制启动哪个程序。
    DO=1或者0控制是否在gcs.exe运行前启动这个程序。
    ----
    在检索窗中，被禁止的停止按钮上双击，可以改变检索式框的尺寸。准确地
说应当是在按钮部件之间的空隙处双击。
    ----
    增加Moveto移至和SaveTo存至功能。
    原来的检索窗批记录存入批控文件和详细窗记录存入ISO2709文件的功能名
改为Export输出。
card.dll
    ----
    以前具有一个中间缓冲区为12000字节，限制了超文本框中装入的最大字符数。
使得一个测试记录在具有110个以上的ISBN号时，超文本框中内容出现截断。
    现在修改这个缓冲区为30000字节。希望够用。

1997.4.12
file2mtf.exe
    ----
    处理记录数起作用了。
    ----
    以前版本当工作单记录中有少于5字符的行时，出现GP错。改正？

1997.4.20
table.dll
    自动产生缺省值的宏%cu%在表格行列互换的时候(当列为主方向时)，应当
拷贝左面一列(同行位置)的内容，但以前版本错误为拷贝上面一行(同列位置)
的内容。此错误已经改正。

1997.4.24
dbengine.exe
    在Windows 95下的GBK国标以外的汉字, 在原来的版本中生成浏览格式的
时候会被空格代替。这个错误已经改正。
    开始实验在dbengine.exe中加入2K X 1000的缓冲区，这个版本没有正式
安装，有兴趣的用户可以在#2盘中找到dbengine.ex_展开代替已经安装的
dbengine.exe。速度加快大约20%。
    此dbengine.exe未加入发行包。

1997.4.26
dbengine.exe
    GBK用到的国标以外的汉字，有的汉字的第1字符的码值正好为136时
(例如‘图’的繁体字)，以前的非用字功能会发生作用，将以后的内容全部忽
略，不参加建立检索点。这个错误已经改正。
    此dbengine.exe未加入发行包。
card.dll
    GBK用到的国标以外的汉字，有的汉字的第2字符的码值正好为{时，与超文
本命令用到的花括号冲突，在记录进入超文本框时警告"Unknown Command[...]"。
此错误已经改正。
gcs.exe
    检索窗和详细窗的布局尺寸改为通过对话框单位计算，使得软件能够自动
适应Windows缺省字体的变化。未改进之前，在以24点阵字体作为缺省字体的
情况下(例如1024X768时的Larg Font状态)，检索窗的检索式输入域高度不够。
特别是在Windows NT中文版3.51下，导致输入此域的文字不可见，其实已经正
确输入，只是显示和光标位置不正常。
    CTRL+S自动加拼音功能增加一种风格，每个拼音的第一字符小写。配置
方法是：在pinyin.cfg配置文件中[style]小节增加UpperFirst = 0一项。
缺省时是拼音第一字符大写。
    详细窗状态条增加插入符位置指示。
editor.dll
    CTRL+M定长输入模板的布局尺寸改为由对话框单位计算。

1997.4.29
gcs.exe
    ----
    加入MARC格式校验功能。有三种方法触发：1.详细窗MARC框中按CTRL+T键；
2.工具条上按“校”按钮；3.编辑/MARC格式校验 菜单命令。位于\dt1000
子目录中的chkmrc.run为运行文件，chkmrc.pro为源文件，可以在DOS下
用precomp.exe编译.pro为.run。
    ----
    工具条上增加“移至”、“存至”、“校验”三个按钮。
    ----
    详细窗的状态条增加“框间切换”、“前一记录”、“后一记录”按钮。
原来位于“选择路径”按钮右方的两个按钮取消。

1997.5.2
gcs.exe
    当检索窗正在检索时，一批简要记录不断到达浏览框中，这时如果切换到
详细窗中，可以进行编辑记录的操作。当检索结束后，原来版本的输入焦点突然
切换到检索窗的浏览框中。
    现已经改进为：检索结束后，如果输入焦点已经不在检索窗，则焦点不切
换到浏览框。
toolbar.dll
    工具条上增加动画，为检索等待过程中带来一些乐趣。
    当光标在工具条的按钮上停留一段时间，会出现关于这个按钮的提示Popup
窗口。如果这个Popup窗口正好位于一个具有输入焦点的窗口的上方，在用键盘
输入字符或键盘操作导致滚动这个窗口时，Popup窗口图象会被破坏。现已改进
为每当有键盘输入时，Popup窗口自动撤消。

1997.5.3
editor.dll
    当一个字段仅占据一行时，用BACKSPACE键在行中删除字符，行末的字符会
在删除操作瞬间被吞掉，但间隔数秒后又恢复。此错误已经改正。

1997.5.5
gcs.exe
    增加未存盘警告功能：详细窗中记录如果修改过而未保存，当进行需要
重新装入记录到详细窗或关闭详细窗的操作时，则出现对话框警告。

1997.5.7
gcs.exe
    详细窗增加CTRL+J观察检索点功能。

1997.5.10
gcs.exe
    详细窗CTRL+A将905$e加入种次号库功能，将$e中的9或99这样的号码
加入种次号库后，立即用CTRL+A自动产生种次号功能，生成的种次号有误。
此错误已经改正。
    另外，CTRL+A功能的提示信息"906$e 自动加同类书区分号(种次号)"
有误，906$e应为905$e。此错误已改正。
dir.dll
toolbar.dll
    这两个控制在退出时没有完全释放资源，在反复进入GCS并且打开
检索窗然后退出GCS的过程中，造成可用资源越来越少。此错误已经改正。
batprint.exe
    部件尺寸改由对话框单位计算。
    原来有一个故障：当活页夹在“索引号范围”上时，最小化本程序，
然后鼠标双击图标恢复本程序，“结束索引号”输入域就不见了。
这个故障由page.dll引起，已经排除。

1997.5.13
editor.dll
    增加鼠标直接移动或拷贝文字块的功能。具体操作方法是：先用鼠标或
键盘定义一个块，然后移动光标到块上，按下左鼠标键不要放开，拖动
鼠标到达要移动块的目的位置，然后放开鼠标键即可。上述操作为移动操作，
如果要拷贝，则应在放开鼠标键之前按住CTRL键，在放开鼠标键之后放开
CTRL键。
    如果拖动光标离开MARC控制，到达能够接受菜单Copy命令的任何窗口上
放开鼠标左键，则可以拷贝块到这个窗口中(这种方式只有拷贝，没有移动功能)。
gcs.exe
    ----
    当检索窗最大化时，在检索窗中双击浏览框打开的详细窗也是最大化的。
但当双击生命块关闭详细窗，然后再次从检索中双击浏览框打开详细窗时，检
索窗和详细窗都变成中等大小。此故障已经排除。
    ----
    检索窗中增加一个功能：当程序退出的时候，会自动保留检索窗目录树中
的当前目录，在下次进入程序打开检索窗的时候，程序自动将目录树打开，当前
选择项停留在这个目录项上。

1997.5.20
output.exe
    新增加的此程序可以打印期刊缺期清单。
batprint.exe
    增加“选项”按钮，在其中可以定义输出到文本文件。

1997.5.25
gcs.exe
    增加期刊单记录打印催缺单的功能。

1997.5.26
jidao.dll
    当记到字段的时间范围子字段内容为少于4字符时，发生一般保护错。
此错误已经改正。

1997.6.2
statis.exe
    新增加的统计程序。
newlang.dll
    新增加的支持统计程序的解释型语言。
util.dll
    新增加的实用函数库。减少程序之间的重复代码。
table.dll
    当CTRL+Z动作的宏定义的百分号不配对时，例如%year%%m2%d2%，CTRL_Z
会引起一般保护错。此错误已经改正。在这种宏名不正确的情况下，软件直接将
宏名插入当前表格单元，以示警告。
    table.dll的外观有改变，反相条的颜色采用了Windows系统配色，更加
正规化。
dir.dll
    dir.dll的外观也有改变，反相条的颜色采用了Windows系统配色。

1997.6.6
table.dll
    以前版本在内务管理系统的详细窗中，针对期刊库用过采购表格编辑
数据，然后切换到典藏表格后编辑数据，如果用到CTRL+Z或者CTRL+L功能
会产生一般保护错。此错误已经改正。

1997.6.13
hyper.dll
batprint.exe
    批打印程序batprint.exe对打印产品增加若干特性：
    页顶空定义    TopBlank=100            缺省为0
    页底空定义    BottomBlank=100         缺省为0
    页眉文字定义  HeaderText = %x=210% 典藏财产帐本 第%page%页
                  其中可以用到 %x=?% %page% %year% %month% %day% 等宏
                  页眉文字的定义需要配合定义页顶空，为打印留出必要的空间
                  缺省为不打印页眉文字
    页脚文字定义  RooterText = %x=210% 典藏财产帐本底部 第%page%页 %year%.%m%.%d%
                  其中可以用到 %x=?% %page% %year% %month% %day% 等宏
                  页脚文字的定义需要配合定义页底空，为打印留出必要的空间
                  缺省为不打印页脚文字
    因为增加这些功能，对hyper.dll进行了改造。

1997.6.23
editor.dll
    插入符在头标区时，按INS键可以在头标区下方插入一个新字段。
hyper.dll
    改进GHP_PRINT消息。原来版本在HP 5L和某些针打上打印功能不正常。现在
已经改正。

1997.6.24
gcs.exe
    检索窗装载Load功能装入批控文件或标目文件时，如果没有预先在目录树
中用鼠标双击展开服务器(以促使软件自动登录)，会导致无法装入。这个局限
已经克服，每当出现这种情况时，软件自动用缺省帐户登录，如果不成功，再
提示用户登录。

1997.6.28
gcs.exe
    增加一个功能：当任何一个书目库的记录调入窗口时，软件会自动生成一个
-01字段插入窗口记录中，内容为记录的路径加上时间标签。这样，当记录
存入书目库时，就记载了曾经住过的地点。在记录转存入别的书目库时，将
带入原先书目库的-01字段，但存入当时并没用含转存目标库的-01字段，不过
一旦存入成功，窗口中将自动增补这个新到达库的-01字段，保证再次转存时
逻辑严密。移入操作类似。对移入操作中当源和目标重叠时的删除操作被小心
防止。
    原来版本中CTRL+A功能主题词自动轮排功能中，当需要轮排类似AAA:BBB-CCC
的情况时(插入符在BBB上)，软件拒绝轮排。此错误已经改正。另外，原来的
autoshu.cfg和autokan.cfg文件中定义轮排功能只针对600和606字段，现在增
补到60*字段。
    增加功能：当记录存入书目库因时间标签过时而受阻时，软件自动将书目
库目标位置记录调入当前窗口作为附加记录与正式记录交错间隔显示，方便核
对记录内容变化情况。从两条记录的-01字段可以看出时间标签的值和变化情况。
可以手动修改时间标签后再次存盘。editor.dll因此做了大量改造。
    详细窗路径框由单行编辑控制变为下拉组合框。其中不但有当前记录的
路径，还特别存放最近用过的10个路径，新的在上。主要为了方便多库操作
中随时回到刚才用过的记录位置，以便进行库中前后翻动的操作。

1997.7.7
gcs.exe
    原来版本中详细窗表格框中引用数据库配置文件macro.cfg中预定义的宏时，
在初次打开表格框时对应格子中CTRL+Z功能不能正确插入值，需要将整个程序
最小化再最大化一次之后CTRL+Z功能才起作用。此错误已经改正。

1997.7.10

table.dll
    原来版本中，在详细窗的表格框中，当CTRL+N在当前行的后方插入一行时，
插入符随之到新的一行上，这时如果立即用CTRL+BACKSPACE删除当前行，会错误
地删除上一行。此错误已经改正。

f2f.exe
    在f2f.ini中增加下列定义小节：
    [905$b --> 906$h]
    source = 905$b
    target = 906$h
    heng = -
    headlen = 1

dbengine.exe
    在dbserver.cfg中增加小节：
    [ConfigFile]
    switch=1
    定义除了root之外的用户是否能够用Dir()看到书目下面的cfgs子目录。
switch=1表示能看到，switch=0表示不能看到。root用户总是能看到的。
缺省状态是switch=1，与以前习惯兼容。

1997.7.19
newlang.dll
    原来版本中，字符串变量以字符串变量直接赋值的操作有误：
    string s1
    string s2

    ...
    s1 = s2

    s2中的内容没有正确送到s1中。
    此错误已经改正。
sep.dll
    在80386 CPU(缺80387)的机器上功能一度不正常，现已改正。
table.dll
    一度出现在表格窗为非激活态时，当前表格单元文字不可见的问题，尤其
是在Windows 3.2缺省颜色下。此错误已经改正。
hotpoint.exe
    一度出现退出后重新进入时警告＂不能启动程序的多个副本＂的故障。
现已排除。

1997.7.20
editor.dll
    当倒数第2个字段的内容为2行以上，插入符在倒数第2个字段的末尾开始用
BACKSPACE键删除字符，直到此字段变为1行，这时倒数第1个字段向上移动一行，
但是原来位置没有刷新，给人的感觉是一下有了两个这样的字段，而且卷滚条
显示也未刷新。此错误已经改正。

1997.7.22
gcs.exe
    增加对Search() API多轮方式的支持。
    ----
    检索窗状态条增加行号功能。

hyper.dll
    增加按西文单词折行效果。
table.dll
    加入表格行时，限制表格为1000行。
newlang.dll
    增加4个函数：DTGetRcd()、GetFld()、GetGroup()和GetSubFld()。
    增加loop、endloop、break关键字，和对loop结构的支持。
util.dll
    修改函数AppendCvtPackageToBatchFile()的参数个数。原来的util.dll
在新版本中不再适用。

1997.7.23
table.dll
    增加右鼠标键弹出可用值菜单的功能。服务器端fld.cfg文件格式因此
作了扩充。

1997.7.25
gcs.exe
    原来版本中，在详细窗MARC框中按CTRL+S键加拼音的功能如果使用次数较多
(大约为100条以上记录加过拼音)，会将Windows资源耗费很多，可能导致许多字体
Windows不能正常显示，只能被迫用缺省字体显示的后果。在详细窗MARC框CTRL+A
功能和检索窗目录树配置文件名上双击都存在类似情况。
    这些错误已经改正。gcs.exe版本升级为3.18。

1997.7.28
card.dll
fldfltr.dll
    原来版本中，如果一个字段没有内容，而且字段结束符位于字段指示符的第
二字符上(在详细窗MARC框中现象为字段指示符第二字符位置发灰)，这样的记录
存盘后再调入详细窗时，发生一般保护错(card.dll)。fldfltr.dll也有类似情况。
    此错误已经改正。
table.dll
    当检索窗浏览框中命中记录很多时，可以用鼠标左键按下后拖动以卷滚表格
行(列)。拖动时如果光标到达浏览框左右边界的外面，继续拖动容易导致出现
一般保护错(table.dll)。此错误已经改正。

1997.7.31
fldfltr.dll
    在MTF2FILE.exe程序中，配置getbm*.cfg时，如果配置字段或子字段不重复，
原来版本不管用。此错误已经改正。
gcs.exe
    检索窗的浏览框中增加对到来的命中内容去重的功能。去重是在获取简要
信息之前进行的。

1997.8.1
newlang.dll
    过去版本在DTScript语言所开的超文本窗中具有多个输入域时，用鼠标点取
激活输入域，图象显示不正确。此错误已经改正。
    过去版本DTScript语言中的注释有时要影响正常代码。此错误已经改正。
statis.exe
    当利用本程序调试DTSript片段程序时，当begin?.pro出错回到本程序面板
状态时，如果不退出本程序，修改begin?.pro为正确后再次按面板上的"开始"
按钮启动本程序，begin?.pro仍报错误。只能退出本程序再进入后才能正确
运行。原因为begin?.pro调用时已经缓冲，错误后未刷新缓冲区。
    在newlang.dll中针对出错情形增加了刷新动作，此错误已经改正。

1997.8.4
hyper.dll
    过去的超文本窗在对输入域操作时，屏幕其余部分的文字变为灰色。输入
域在输入时的显示定位也不准确。在多个超文本窗中同时存在输入域时容易出现
一般保护错。
    输入域已作了改进，输入域显示稳定、准确。

1997.8.7
gcs.exe
    增加查重功能，在详细窗的MARC框中用CTRL+L键触发。关于查重的特性定义
在gcs.ini中。

1997.8.8
hyper.dll
    增加对条码打印的支持。在超文本中用{Font:BarCode39}设置字体即可显示
和打印39码。本功能要求在\windows\system子目录中存在cb39001_.ttf文件和
在\dt1000子目录中存在font.fot文件。当然，安装程序setup.exe会自动安装
这两个文件。

1997.8.9
gcs.exe
    以前的版本中，本程序遇到服务器按照淘汰算法切断通道时，不能自动重
新申请通道和重新登录。比如在详细窗中录入数据时，如果服务器
在用户不知觉的情况下切断了当前窗口申请的通道，等到用户进行保存操作时，
就会报Invalid Parameter或Not Enough Channel错，保存操作不能完成。
    现在已经加入自动重新申请通道的算法，在遇到上述情况时会自动解决
问题，对用户是透明的。

1997.9.4
gcs.exe
    详细窗MARC框的CTRL+N功能变为新的词表检查功能，原来功能移动到
CTRL+F键上。

1997.9.5
hyper.dll
    以前版本中对GBK汉字字符的右半为'\'时错误解释为转义字符，
造成显示乱字。现已改正。

1997.9.9
statis.exe
    增加针对词表进行批规范检查的功能。只需要在statis.ini中增加一种
名叫"规范检查"的统计事项即可，小节[规范检查]不需要定义。

1997.9.19
gcs.exe
    打印功能中增加打印份数功能。但是在打印机面板上的份数不起作用。
batprint.exe
    除了"选项"中的打印份数外，打印机面板上的份数也起作用。
这两处在时间上最后设置的值起作用。hyper.dll也增补了相关功能。

1997.10.1
newlang.dll
    以前版本中CutStr(s,offs,len)函数中如果len为负数，将导致一般保护错，
现已改正。
dbengine.exe
    启用新的版本，在Search() API长时间未命中的情况下，能够快速周转。
    通道切断后，访问被切断的通道时dbkernel.dll返回的错误码由原来的
GL_INVALIDPATH和GL_NOCHANNEL改为GL_INVALIDCHANNEL。
gcs.exe
    配合dbengine.exe新版本，在处理Search() API中间未命中包方面有改进。
    通道被服务器切断后重试的算法有改动。
    检索窗有改进：检索窗浏览框在检索第一阶段进行中处于Disable状态，
标志是出现等待光标。第二阶段(装入简要记录阶段)浏览框可以使用，但是
在非DBKERNEL模式下双击装入详细记录时可能会报"重入"错。
jidao.dll
    增加功能：合刊、合订、块操作、屏蔽、智能屏蔽。

1997.10.5
hotpoint.exe
    配合dbengine.exe新版本，在处理Search() API中间未命中包方面有改进。
如果将旧版本的hotpoint.exe与新版本的dbengine.exe配合使用时，检索结果
可能会不正确。
batprint.exe
newlang.dll
    为批打印并统计作了改进。
    在end.pro的阶段可以用一个字符串环境变量EndPrintFileName，如果向
其中赋一个超文本文件名，并且end.pro以0返回，batprint.exe将在整个批打
印的最后加上这个超文本文件的内容。变量EndPrintFileName不用事先申请。

1997.10.6

gcs.exe
    上一个版本当删除一个记录而当前帐户没有这个记录所在区段的写权限时，
gcs.exe陷入死循环。此错误已经改正。

tcps.dll
    原来版本中，当一台机器的不同任务(Task)向TCPS.DLL申请与同一个IP地址
的服务器联结时，为节省通讯资源使用了同一个socket，这样，不同任务之间密
集进行的操作容易导致通讯收发顺序混乱。例如，启动mtf2file.exe从服务器转
出数据时，再启动gcs.exe检索这个服务器，容易导致批处理程序中断或者检索
失败的结果。这种同时启动多个任务的机会不是很多，因而节省socket意义不大，
所以新版本改进(还原)为不同的任务针对同一个IP也使用不同的socket。这样，
上述缺点全部得到克服。在新版本中，可以看到不同的任务在服务器端
tcprecv.exe中会开辟不同的通道窗，各自进行独立的操作。

tcprecv.exe
    PORT窗界面改进，增加了一个表格框，显示正在使用的通道的信息。
    程序首次启动时缺省的状态为不显示详细通讯信息。
    CHANNEL窗标题增加显示Client端IP地址和用户名项。
    在Windows启动目录中，tcprecv.ini文件配置了tcprecv.exe程序的特性，
现增加IP地址检查功能。在tcprecv.ini文件中，如果配置了下面内容：
[Friend IP]
1 = 132.147.160.1
2 = 132.147.160.2
3 = 202.112.*.*

[Enemy IP]
1 = 132.147.160.7
2 = 132.147.160.8
    表示132.147.160.1、132.147.160.2以及202.112(子网)这些IP地址都可以被允许
访问本服务器，而132.147.160.7和132.147.160.8将被拒绝访问本服务器。
被拒绝的前端也许会显示"recv() error"之类的错误信息。
    如果[Friend IP]小节缺省，表示所有IP均可访问本服务器，但最后仍然要受
[Enemy IP]小节的制约。如果[Enemy IP]小节缺省，表示不拒绝任何IP，但是同时要
受[Firend IP]小节的制约。
    详细说明：如果[Friend IP]小节和[Enemy IP]小节均缺省，这时
真正表示任何IP均可访问。如果仅仅有[Friend IP]小节，指定的IP可以访问，在
指定范围外的IP被拒绝。如果仅仅有[Enemy IP]小节，指定的IP被拒绝，在
指定范围外的IP可以访问。如果两个小节均有，首先看[Friend IP]小节，然后
在允许访问的集合内看[Enemy IP]小节，在允许访问的集合中进一步除去拒绝访问
的IP，剩下的IP就是允许访问的IP。如果在两个小节中均定义了相同的IP地址，则
[Enemy IP]小节最后起作用，拒绝访问。

1997.10.9
table.dll
    原来版本中，gcs.exe的检索窗浏览框如果装入事项不全的行，在此行上双击
会出现GP错。此错误已改正。

1997.10.10
toolbar.dll
    在状态条文字域中可以设置比例条背景。
gcs.exe
    检索窗状态条提示信息背景增加比例显示特性。在简要记录装入浏览框的时候
在提示信息背景上显示装入的比例。
    在检索命中的简要记录装入浏览框过程中，如果按下SHIFT键可以仅将记录的
路径装入，不装入简要信息，也即不和服务器打交道，可以提高装入速度。在仅
有路径的行上双击鼠标仍然可以将详细记录装入详细窗。
dt1000.cmd
    安装宏程序作了改进，增加"升级安装"的特性，只安装.exe和.dll。
    如果安装前机器上c:\dt1000子目录存在dbserver.cfg文件，安装程序会探测
到，提示是否升级安装。

1997.10.20
jidao.dll
    智能屏蔽项在内容太多时简单风格的Popup子菜单放不下，现改为多列菜单。
在table.dll中的右鼠标键菜单受此启发也改为项目多时呈多列。

1997.10.21
tcps.dll
    在tcps下存在多个IP地址时，如果交替使用这些IP地址，会造成先前用过的
IP地址sub_channel无效，症状时先前登录(CD()API)过突然变得无效，要求重新
登录。此错误已经改正。
tcprecv.exe
    当channel窗因为对方(Client)通讯中断引起FD_CLOSE事件时，此窗口虽然
关闭，但tcprecv程序的window下拉菜单中的窗口名项并未取消，激活tcprecv
主窗口或选取window下拉菜单中的残留窗口名项时，tcprecv会出现GP错。
此错误已经改正。
dt1000.cmd
    安装前disk1上文件mtf2file.ini改为mtf2file.in$，里面含有定位实际
安装目录的宏。

1997.11.4
gcs.exe
    新版本3.20有一个重大改进，采用DTScript语言(Newlang.dll)实现gcs.exe
详细窗中超文本框的格式生成。旧版本软件升级后，需要在服务器所\dt1000\cfgs
子目录中增加一些新的配置文件，这些配置文件的名字可以从安装盘
dbserver.cfg中各库的hyper.cfg项中查得。如果新的gcs.exe安装上后，服务
器中并未安装新的配置文件，gcs.exe程序仍采用旧的方法生成超文本(fldfltr.dll
或card.dll)。

newlang.dll
    增加DTscript语言的一种特殊格式.flt，支持高度灵活地输出超文本或
其它格式文件，详细用法请参考软件手册。
    增加函数HanziPrice(int price, string &hanzi)可以将以分为单位的数字
值price转换为汉字大写的金额。
    函数PrintWindow()参数增加，为PrintWindow(int window, int style)，
style为0时，连续每次调用此函数都出现打印机对话框；style为1时，连续调用
只有第一次出现打印机对话框；style为2时，只选打印机而不打印，如果后面
配合以style为1调用本函数可不再出现对话框；style为-1时，迫使下次调用
本函数时出现打印机对话框。以旧参数PrintWindow(int window)调用本函数
也兼容，相当于style为0的效果。

mtf2file.exe
    在过滤器middle.pro中可以使用RecBuff环境变量了。

output.exe
    增加利用jidao.dll进行报纸催缺的功能，在output.ini可配置如下小节：
[报纸缺期帐簿]
fld.cfg=C:\DT1000\clntcfgs\fld21.cfg
ctl.cfg=C:\DT1000\clntcfgs\ctl21.cfg
style=tableline
includehead=1
记到字段=920
催缺方式=图象

begin.pro=C:\DT1000\clntcfgs\begin99.pro
middle.pro=C:\DT1000\clntcfgs\middle99.pro
end.pro=C:\DT1000\clntcfgs\end99.pro
filter.cfg=C:\DT1000\clntcfgs\filter99.cfg

    在过滤器的middle.pro中可以利用下列环境变量进行统计：
MI_ArriveCount     int型 实到期数
MI_TotalCount      int型 应到期数
MI_MissCount       int型 有缺漏的期数
MI_ZeroCount       int型 全缺的期数
MI_CeTotalCount    int型 应到张数(==期数*订购份数，下同)
MI_CeArriveCount   int型 实到张数
MI_CeMissCount     int型 缺张数
     打印前送到超文本窗的宏如下：
%QueQi%            缺期字符串
%Path%             当前记录路径

1997.11.6
editor.dll
    在MARC编辑控制中，当整个记录的高度小于当前窗口的高度，在某一字段多
于一行，在字段末尾用BackSpace键向左删除字符直到此字段为一行，当此字段
下方的其它字段向上卷滚时，最下方会残留一行图像。此错误已经改正。
util.dll
    在获取服务器上的配置文件时，增加显示一个对话框，当远程应用速度较慢
时，给操作者足够的提示信息。
newlang.dll
    增加函数CutHanziStr(sting &s, int start)，将字符串从start开始处切
除后面的字符。当切除位置为汉字半个的位置时，函数自动向后调整一个字符。

1997.11.9
jidao.dll
    增加一个3行的显示态，与原来的1行、2行的态同用左鼠标键在水平和垂直
标题的交会处双击循环切换。这个3行的态在中间一行用蓝色字符显示预测码。
    在日历格子中用右鼠标弹出菜单。在菜单中现增加了"设置预测码"和"智能
预测"两个功能。设置预测码功能在只选择了一个格子时，改变当前格子的预测
码；在选择了若干格子时，同时修改所选择的全部格子的预测码。智能预测
功能类似于智能屏蔽功能，为选择的若干格子依一定的时间条件模式设置预测码，
设置预测码的策略在mask.ini中定义，类似于下面：
[预测类型]
entry1 = 周日单出
entry2 = 周六合刊

[周日单出]
1 = week,B,0
2 = week,A,1,2,3,4,5,6

[周六合刊]
1 = week,A/B,6
2 = week,A,1,2,3,4,5
例如，"1=week,A/B,6"表示按照周的规律为每周星期6设置屏蔽码'A/B'。如果
屏蔽码定义为类似'?A'这样，表示先出现一个对话框询问操作者，问号后面的
内容作为缺省值供参考。

1997.11.10
gcs.exe
    详细窗CTRL+A功能对中央库、采购库增加2个功能：960$e(复本量)-->905$b
和 905$b-->登录号库。实际上这两个功能将当前登录号尾号存放在＂种次号＂
库中，key为"登录号"，内容即为实际的号码。
    960$e-->905$b功能在"种次号"库中查找当前登录号尾号，
再根据本记录中的960$e计算出号码范围和新的尾号，将号码范围产生出一个
新的905$b来，然后将新的尾号以"登录号"为key存入"种次号"库，以备下次
使用。
    905$b-->登录号库功能获得当前插入符所在的905$b中的号码范围，将
此号码范围的尾号加一后存入"种次号"库。
    为增加这两个功能，\dt1000\cfgs\下autoshu.cfg作了增补。

1997.11.12
hyper.dll
    利用.prn文件进行的批打印中，超文本命令Color现在已经支持。
    利用.prn文件进行的批打印中，原来的版本，当表格内容高度超过一页纸张
的高度时，会导致无数空走纸和hyper.dll产生GP错。现已改正，在这种情况下仅
打印纸张能够装下的内容，多出的内容被省略。另外，在一页纸张上装配
若干个逻辑页面时，原来判断不能装下的条件包括一个逻辑页面大于和等于
纸张高度的情况，现在已改为仅包括大于的情况。

1997.11.13
hyper.dll
    在"图书订购清单"打印并统计的DTScript程序中，最后的统计结果将附着
在成批打印的表格后面。当表格打印完后剩下的纸张不够打印统计结果时，
并不打印到下一页而是被省略了。这个问题通过在最后生成的统计结果
超文本文件的开始增加一个{BatStyle:0}命令加以解决。这个命令的用途
是改变整个.prn文件打印的INCLUDEHEAD风格为普通风格，以免打印时省略
不该省略的内容。

1997.11.15
table.dll
    在初始化表格字段内容的操作中，当特定的条件不具备而返回时，可能
出现申请的空间释放不干净的情况，这样会导致gcs.exe详细窗MARC框的
CTRL+A功能在使用次数很多时内存耗费量大，出现运行缓慢或GP故障。此
错误已经改正。
editor.dll
    在MARC框中按CTRL+M弹出模板编辑定长代码化字段的功能，原来不能
处理一个字段中多个子字段的情形。现在增加了处理多个子字段的能力。
在moban.cfg配置文件中，要配置$a上模板，小节名可以仅用字段名即可；
如果要配置$a以外的其它子字段上模板，小节名必需为[???$?]形式，其中
前三位为字段名，最后一位为子字段名的字母符号。其他事项的配置同原
来方法。
    在使用CTRL+M功能时，需要注意的是当插入符在一个子字段的''符号
与左方一个字符的中间时，当前插入符位置触发的模板是右面的
子字段的模板。

1997.11.18
gcs.exe
     在"功能"菜单中增加命令"报刊装订"和"生成装订数据"。
    "报刊装订"功能将预先在jidao.cfg中定义好
的若干记到字段中的内容迭加装入一个记到框，记到框中便出现装订态的数据。
如果其中有字符发蓝的格子，表示是以前已装订过的区域，本次不能操作。
操作者需在此框中用CTRL+左鼠
标双击定义分割(红竖线)标记，表示装订时各册的分界点，然后选择一个包括
所有将要装订的期的块，再用右鼠标键选择"自动生成装订数据"命令(或者菜单命令
"功能/生成装订数据")，就可以自动
在907(缺省)字段追加(或新生成)装订信息。如何在907字段生成装订信息受
配置文件jidao.cfg控制，与装订有关的内容如下：

[装订]
field1 = 920              ;以下为参与装订的若干记到字段名
FRAME1 = jidaoframe                     和子字段框架
field2 = 921
FRAME2 = jidaoframe
field3 = 922
FRAME3 = jidaoframe
field4 = 923
FRAME4 = jidaoframe
field5 = 924
FRAME5 = jidaoframe
TargetField = 907                  ;存放装订信息的目标字段
TimeRange = $y                     ;时间范围
OperTime = $d,%year%%m2%%d2%       ;操作时间
DupNo = $s                         ;复本号(色标)
IncludeSeq = $q                    ;包含期号序列
MissSeq = $m                       ;缺期序列
dup = 2                            ;装订复本数
OperAccount = $r,%username%        ;操作帐户名
BatchNo = $b,%no_zhuangding%       ;批次号

[jidaoframe]
entry1 =$a,@a出版日期,basetime
entry2 =$w,@w总期号,firstseq
entry3 =$c,@c实到份数,copy
entry4 =$n,@n期号,otherseq
entry5 =$Z,@Z掩码,binmask
entry6 =$Y,@Y掩码,dismask
entry7 =$X,@X预测码,future

1997.11.20
table.dll
    原来版本表格框中(以行列未互换为例)，当激活的格子是某行的第1列以外时，
如果此时按CTRL+L键自动生成本行的若干列的值，这时当前激活格子的内容会跑
到本行第一列上。此故障已经排除。
    另外，原来CTRL+L键的功能不管格子中是否有值，都用新的值覆盖。听取用户
意见，现已改为如果格子中已经有值则不覆盖以新的值，只在空的格子中插入新值。

1997.11.21
newlang.dll
    DTScript语言的stop语句如果返回一个局部变量的值，例如下面程序片段：
    begin
       int rtn
       ...
       ...
       stop rtn
    end
    在原来版本中，上述情况stop语句会报错，认为rtn变量不存在，原因是堆栈
上的局部变量释放的时机不恰当。此错误已经更正。
batprint.exe
    在执行DTScript程序的middle片断时，增加一个功能，如果middle.pro用stop
语句返回的值为>1的值，则作为控制当次打印的份数值。如果在batprint面板上设
置了打印份数，就打印(返回值*面板份数)那么多份。这个功能首先被用于按照
905$f的值作为打印份数打印标签。
    在原来的版本中，middle.pro返回0表示后面的当次打印正常进行，即打印1份
(当然，如果在batprint面板上设置了打印份数，就打印那么多份)；返回1表示后面
的当次打印被取消，但后面的middle循环继续进行。新版本对返回>1值作的规定，
是对旧版本的补充，与旧版本已有的规定不矛盾。

1997.11.23
editor.dll
    原来的版本在MARC框的字段名(及字段指示符)域输入汉字未加以禁止，有时会
导致子字段域汉字输入混乱。现在已禁止在字段名域输入汉字字符，准确地说是
禁止除空格,-,0~9,a~z,A~Z以外的字符。如果输入被禁止的字符，软件会以响声警
告。
gcs.exe
    在工具条打印按钮功能中，增加了利用hyper.cfg配置打印格式的能力。
hyper.cfg是取代原来fld.cfg加ctl.cfg的更先进的打印格式，如果在batprint.ini
的一个产品中同时配置新旧两种方式，则新方式起作用。如果没有配置新方式，
则旧方式起作用。为了避免引起概念混乱，在以新方式配置的产品小节中不要再
保留旧方式的fld.cfg和ctl.cfg两行。如果hyper.cfg运行中发生错误，将出现
错误信息窗口。
batprint.exe
    增加了利用hyper.cfg配置打印格式的能力。hyper.cfg是取代原来fld.cfg
加ctl.cfg的更先进的打印格式，如果在batprint.ini的一个产品中同时配置新
旧两种方式，则新方式起作用。如果没有配置新方式，则旧方式起作用。为了
避免引起概念混乱，在以新方式配置的产品小节中不要再保留旧方式的fld.cfg
和ctl.cfg两行。如果hyper.cfg运行中发生错误，将出现错误信息窗口。
hotpoint.exe
    增加利用数据库下hyper.cfg文件配置的显示格式的能力，类似于gcs.exe
详细窗超文本框。

1997.11.30
newlang.dll
    增加函数GetDate(string &date)，可以得到当前日期，格式为YYYYMMDD。
    原来的函数DateCmp(string date1, string date2)在两个日期格式均为
YYYYMMDD的时候，返回码只代表时间先后，不是两个日期的间隔日；现在改为
返回两个日期的间隔日。例如DateCmp("19970102","19970101")返回1，表示两
个日期之间差1日，正的差值表示日期1从时间上看在后。此函数功能增强后，
返回正、0、负值表示的含义同旧版本的此函数。

1997.12.4
gcs.exe
    详细窗MARC框CTRL+A功能的{MoveTo}宏，在执行{MoveTo:%%%$b|102$b|102**}
过程中，如果当前插入符位置已经在102字段的$b子字段上，应当不再移动当前
插入位置，原版本中此功能表现不正常，现已更正。
    gcs.exe现版本号为3.22。

1997.12.5
newlang.dll
    .FLT程序中，_SUBFIELDNAME和_PREVSUBFIELDNAME变量内容现改为只包含一个
字符。原来程序中类似if (_SUBFIELDNAME=="a")这样的语句应该改为
if (_SUBFIELDNAME=="a")。安装包中所有的.flt文件均作了修改。因为利用
#1盘进行升级安装不影响到已经安装好的旧配置文件，因此老用户在升级安装
后需要手动修改所有.flt文件。

1997.12.7
gcs.exe
    "刷新网络配置文件本地映象"功能增加刷新DTScript格式转换程序代理窗的
功能。
    "MARC格式"校验功能使用的配置文件(格式转换程序)跟随记录从属数据库存
放。
    gcs.exe现版本号为3.23。
newlang.dll
    DTScript语言增加函数VerifyISBN(string ISBN, string &errorstring)
和InStr(string s,int ch)。

1997.12.8
newlang.dll
    DTScript语言增加函数VerifySubField(string field, string norepeat,
string nomiss, string &errorstring)和VerifyIndicator(string indicator,
string case1, string case2, string &errorstring)。
hyper.dll
    利用.prn批打印时，可以设置中间暂停的风格PTP_PAUSE。
batprint.exe
    "选项"对话框中增加"每张之间暂停"的开关。选择每张之间暂停的特性后，
在向打印机送一页打印内容之前，都要出现对话框等待操作者装纸。这个功能
主要针对LQ1600K这样的打印机打印单页纸的情况：如果不在每张之间暂停一下，
直接在装纸之后按打印机联机开关继续打印，会在打印的内容中出现乱码。

1997.12.9
gcs.exe
    工具条上的打印功能，增加了两个部件："运行DTScript片断程序"开关和
"立即运行end.pro"按钮。
    "运行DTScript片断程序"处于选中状态时，如果当前打印产品配置了DTScript
片断程序(在batprint.ini产品中配置了begin.pro、middle.pro和end.pro事项)，
就在打印前后恰当的时机运行DTScript程序。
    "立即运行end.pro"按钮的作用是手动运行当前打印产品的end.pro，如果
配置了DTScript片断程序的话。因为batprint.exe程序有明显的运行结束时机，
在处理完最后一条记录后运行end.pro；而此处没有明显的结束概念，必须在
即将处理的最后一条记录已经装入到打印对话框后，按此按钮运行end.pro。
运行end.pro后，立即将缓冲的全部内容送到打印机打印。
    这两个部件加上后，对于配置有DTScript片断程序的打印产品，
工具条打印功能和Batprint.exe的打印功能就非常相似了。

1997.12.22
batprint.exe
statis.exe
mtf2file.exe
file2mtf.exe
output.exe
logutil.exe
hotpoint.exe
    增加了退出时的"正在退出???..."对话框。

1997.12.23
hotpoint.exe
    增加了对@引导的精确一致检索词的支持。

1997.12.24
batprint.exe
mtf2file.exe
statis.exe
output.exe
    如果*.ini中的一个产品没有配置filter.cfg，则运行middle.pro时可能会报
RecPath未定义。此错误已经改正。
jidao.dll
    增加对操作者和操作日期的支持。需要在[jidaoframe]中增加opertime和
username两种类型的子字段，例如:
entry10 =$t,@t到刊时间,opertime
entry11 =$p,@p操作者,username
这样，在记到操作过程中，软件会自动生成操作者(当前帐户)和操作日期信息。

与之配套，output.exe还增加了按操作日期和操作者统计记到工作量的功能，
典型的统计产品小节(在output.ini中)如下:
[邮发报工作量统计]
记到字段=920
催缺方式=操作日期
sepfield=920
begin.pro=C:\DT1000\clntcfgs\begin160.pro
middle.pro=C:\DT1000\clntcfgs\midd160.pro
end.pro=C:\DT1000\clntcfgs\end160.pro
在midd160.pro中，可以使用的有关统计的环境变量如下：
MI_lpBuffer    操作者名(帐户名)
MI_ArriveCount 到齐期数
MI_MissCount   缺期数
MI_TotalCount  应到总期数
MI_ZeroCount   全缺期数
MI_CeArriveCount 实到册数
MI_CeMissCount   未到册数
MI_CeTotalCount  应到总册数

1997.12.29
batprint.exe
output.exe
    如果*.ini中的一个产品没有配置begin.pro，则运行middle.pro时可能会报
PrintWnd未定义。此错误已经改正。

<EOF>
